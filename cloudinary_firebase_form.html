<!DOCTYPE html>
<html>
<head>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: Arial, sans-serif;
background-color: #f5f5f5;
color: #333;
}
h1 {
color: #001f3f;
text-align: center;
margin: 30px 0 20px 0;
font-size: 32px;
}
.required-note {
color: #001f3f;
font-size: 14px;
margin-bottom: 20px;
font-weight: bold;
}
form {
max-width: 900px;
margin: 0 auto;
background-color: white;
padding: 40px;
border-radius: 8px;
box-shadow: 0 2px 10px rgba(0, 31, 63, 0.1);
}
.form-section {
margin-bottom: 40px;
padding-bottom: 30px;
border-bottom: 2px solid #e0e0e0;
}
.form-section:last-of-type {
border-bottom: none;
}
.section-title {
color: white;
background-color: #001f3f;
padding: 12px 16px;
border-radius: 4px;
margin-bottom: 20px;
font-size: 18px;
font-weight: bold;
}
.form-row {
display: flex;
gap: 20px;
margin-bottom: 20px;
}
.form-row div {
flex: 1;
}
.form-row p {
margin: 0 0 8px 0;
}
.form-row input {
width: 100%;
padding: 12px;
border: 2px solid #ddd;
border-radius: 4px;
font-size: 14px;
transition: border-color 0.3s;
}
.form-row input:focus {
outline: none;
border-color: #001f3f;
box-shadow: 0 0 5px rgba(0, 31, 63, 0.2);
}
p {
margin: 0 0 8px 0;
line-height: 1.6;
color: #333;
font-size: 15px;
}
label {
font-size: 15px;
margin-right: 15px;
cursor: pointer;
display: inline-flex;
align-items: center;
}
input[type="text"],
input[type="email"],
input[type="tel"] {
width: 100%;
padding: 12px;
border: 2px solid #ddd;
border-radius: 4px;
font-size: 14px;
margin-bottom: 12px;
transition: border-color 0.3s;
}
input[type="text"]:focus,
input[type="email"]:focus,
input[type="tel"]:focus {
outline: none;
border-color: #001f3f;
box-shadow: 0 0 5px rgba(0, 31, 63, 0.2);
}
input[type="checkbox"] {
width: 18px;
height: 18px;
margin-right: 8px;
cursor: pointer;
accent-color: #001f3f;
}
.checkbox-group {
margin: 15px 0;
}
.checkbox-group label {
display: flex;
align-items: center;
margin-bottom: 10px;
}
.error-message {
color: #d32f2f;
font-size: 13px;
margin-top: 5px;
display: none;
}
button[type="submit"] {
background-color: #001f3f;
color: white;
padding: 14px 40px;
border: none;
border-radius: 4px;
font-size: 16px;
font-weight: bold;
cursor: pointer;
margin-top: 20px;
transition: background-color 0.3s;
width: 100%;
}
button[type="submit"]:hover {
background-color: #000d1f;
}
button[type="submit"]:active {
background-color: #000;
}
button[type="submit"]:disabled {
background-color: #ccc;
cursor: not-allowed;
}
.hidden {
display: none;
}
.logo {
max-width: 100%; 
height: auto;    
display: block;  
margin: 0 auto;   
}
.success-message {
background-color: #4CAF50;
color: white;
padding: 15px;
margin: 20px 0;
border-radius: 4px;
text-align: center;
display: none;
}
.error-alert {
background-color: #f44336;
color: white;
padding: 15px;
margin: 20px 0;
border-radius: 4px;
text-align: center;
display: none;
}
.loading {
display: none;
text-align: center;
margin: 20px 0;
}
.loading::after {
content: '';
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid #f3f3f3;
border-top: 3px solid #001f3f;
border-radius: 50%;
animation: spin 1s linear infinite;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

/* Cloudinary Upload Widget Styles */
.upload-widget {
border: 2px dashed #ddd;
border-radius: 4px;
padding: 20px;
text-align: center;
cursor: pointer;
transition: border-color 0.3s;
margin-bottom: 20px;
}
.upload-widget:hover {
border-color: #001f3f;
background-color: #f9f9f9;
}
.upload-preview {
margin-top: 15px;
}
.upload-preview img {
max-width: 200px;
max-height: 200px;
border-radius: 4px;
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.upload-status {
margin-top: 10px;
font-size: 14px;
color: #666;
}
</style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
<img src="./1.png" alt="Storage Plus Logo" class="logo">
<h1>Storage Plus Intake Form</h1>

<p class="required-note">* Indicates required fields</p>

<!-- Success Message -->
<div id="success-message" class="success-message">
  Form submitted successfully! Redirecting to thank you page...
</div>

<!-- Error Alert -->
<div id="error-alert" class="error-alert">
  Error submitting form. Please try again or contact support.
</div>

<!-- Loading Indicator -->
<div id="loading" class="loading">
  Submitting your form, please wait...
</div>

<form id="intakeForm">
<div class="form-section">
<div class="section-title">Contact Information</div>
<div class="form-row">
<div>
<p>Mobile #: <span style="color: red;">*</span></p>
<input type="tel" name="mobile_number" required placeholder="Enter mobile number">
</div>
<div>
<p>Work#:</p>
<input type="tel" name="work_number" placeholder="Enter work number">
</div>
</div>

<p>Primary Email Address: <span style="color: red;">*</span></p>
<input type="email" name="email" required placeholder="Enter email address">
<p>Opt in for Text Messages(Msg & Data rates may apply) <span style="color: red;">*</span></p>
<div class="checkbox-group">
<label>
<input type="radio" name="text_opt_in" value="Yes" id="text_yes"> &nbsp; &nbsp; &nbsp; Yes
</label>
<label>
<input type="radio" name="text_opt_in" value="No" id="text_no"> &nbsp; &nbsp; &nbsp; No
</label>
<div id="text-checkbox-error" class="error-message">Please select Yes or No for text message opt-in</div>
</div>
</div>    

<div class="form-section">
<div class="section-title">Personal Information</div>
<p>Business Name(if applicable):</p>
<input type="text" name="business_name" placeholder="Enter business name">

<div class="form-row">
<div>
<p>First & Middle Name <span style="color: red;">*</span></p>
<input type="text" name="first_middle_name" required placeholder="Enter first & middle name">
</div>
<div>
<p>Last Name <span style="color: red;">*</span></p>
<input type="text" name="last_name" required placeholder="Enter last name">
</div>
</div>

<p>Address: <span style="color: red;">*</span></p>
<input type="text" name="address" required placeholder="Enter street address">
<div class="form-row">
<div>
<p>Apt/Ste/FL: <span style="color: red;">*</span></p>
<input type="text" name="apt_ste_fl" required placeholder="Apartment/Suite/Floor">
</div>
<div>
<p>City: <span style="color: red;">*</span></p>
<input type="text" name="city" required placeholder="Enter city">
</div>
</div>
<div class="form-row">
<div>
<p>State: <span style="color: red;">*</span></p>
<input type="text" name="state" required placeholder="Enter state">
</div>
<div>
<p>Zip code: <span style="color: red;">*</span></p>
<input type="text" name="zip_code" required placeholder="Enter zip code">
</div>
</div>
</div>

<div class="form-section">
<div class="section-title">Emergency Contact</div>
<p>We will only contact this person in the event of an emergency or as a last resort if the unit is assigned to auction.</p>
<p>First and Last Name: <span style="color: red;">*</span></p>
<input type="text" name="emergency_person_1" required placeholder="Enter first and last name">

<div class="form-row">
<div>
<p>Phone: <span style="color: red;">*</span></p>
<input type="tel" name="emergency_phone" required placeholder="Enter phone number">
</div>
</div>
</div>

<div class="form-section">
<div class="section-title">Additional Access Authorization</div>
<p>Additional Person(s) authorized for Access (vacate/close account, transfer, cutluck):</p>
<p>First and Last Name #1:</p>
<input type="text" name="authorized_person_1" placeholder="Enter first and last name">
<p>First and Last Name #2:</p>
<input type="text" name="authorized_person_2" placeholder="Enter first and last name">

<div class="form-row">
<div>
<p>Phone #1:</p>
<input type="tel" name="phone_1" placeholder="Enter first phone number">
</div>
<div>
<p>Phone #2:</p>
<input type="tel" name="phone_2" placeholder="Enter second phone number">
</div>
</div>
<p>Owner hereby grants month to month permission to the occupant listed above to store personal property according to the terms and conditions of this agreement in the stored unit at the facility first name above commencing on ____: <span style="color: red;">*</span></p>
<input type="text" name="commencement_date" required placeholder="Enter start date">
</div>

<div class="form-section">
<div class="section-title">Payment Information</div>

<p><strong>Choose Payment Type: <span style="color: red;">*</span></strong></p>

<label>
<input type="radio" name="payment_type" value="Cash" onclick="togglePaymentOptions()">
Cash
</label>

<label>
<input type="radio" name="payment_type" value="Card" onclick="togglePaymentOptions()">
Card
</label>

<div id="payment-type-error" class="error-message">Please select Cash or Card</div>

<br><br>

<div id="cardSubOptions" class="hidden">

<p><strong>Card Payment Options:</strong></p>

<label>
<input type="radio" id="box1" name="payment_method" value="Call In Payment">
Call-In Payment
</label>

<label>
<input type="radio" id="box2" name="payment_method" value="Auto-payment">
Auto-payment
</label>

<div id="checkbox-error" class="error-message">Please select a card payment option</div>

<br><br>

<p>Card Number: <span style="color: red;">*</span></p>
<input type="text" name="card_number" placeholder="Enter card number" id="card_number_field">

<p>CVV: <span style="color: red;">*</span></p>
<input type="text" name="card_cvv" placeholder="Enter CVV" id="card_cvv_field" maxlength="4">

<p>Expiration Date (MM/YY): <span style="color: red;">*</span></p>
<input type="text" name="card_expiration" placeholder="MM/YY" id="card_expiration_field">

</div>
</div>

<div class="form-section">
<div class="section-title">Government Issued ID Upload</div>
<div class="upload-widget" onclick="openCloudinaryWidget()">
  <div id="upload-text">
    ðŸ“¸ Click here to upload your Government Issued ID
    <br><small>Accepted formats: JPG, PNG, PDF (Max 5MB)</small>
  </div>
  <div class="upload-preview" id="upload-preview"></div>
  <div class="upload-status" id="upload-status"></div>
</div>
<input type="hidden" name="id_image_url" id="id_image_url" required>
<input type="hidden" name="id_image_public_id" id="id_image_public_id">
</div>

<div class="form-section">
<div class="section-title">Agreement & Signature</div>
<p>Name: <span style="color: red;">*</span></p>
<input type="text" name="full_name" required placeholder="Enter your Full Name" maxlength="100">
</div>

<button type="submit" id="submitBtn">Submit Form</button>
</form>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<!-- Cloudinary Widget -->
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>

<script>
// Initialize Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDxqszQiV8YOQ15QXrFuyeUOYPOdfG-BHQ",
  authDomain: "intake-form-e180e.firebaseapp.com",
  projectId: "intake-form-e180e",
  storageBucket: "intake-form-e180e.appspot.com",
  messagingSenderId: "97526846862",
  appId: "1:97526846862:web:a49c6f44241b3eb2a9c0df"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Cloudinary Configuration
const cloudinaryConfig = {
  cloudName: "dcm0nuwpv", // Your Cloudinary cloud name
  uploadPreset: "storage_plus_unsigned", // Your upload preset
  folder: "storage_plus_ids" // Optional: folder name in Cloudinary
};

// Image upload state
let uploadedImageData = null;

// Form validation and submission functions
function togglePaymentOptions() {
  const cardSelected = document.querySelector('input[name="payment_type"][value="Card"]').checked;
  const cardDiv = document.getElementById("cardSubOptions");
  
  const cardNumber = document.getElementById('card_number_field');
  const cardCvv = document.getElementById('card_cvv_field');
  const cardExpiration = document.getElementById('card_expiration_field');

  if (cardSelected) {
    cardDiv.classList.remove("hidden");
    cardNumber.required = true;
    cardCvv.required = true;
    cardExpiration.required = true;
  } else {
    cardDiv.classList.add("hidden");
    cardNumber.required = false;
    cardCvv.required = false;
    cardExpiration.required = false;
    document.getElementById("box1").checked = false;
    document.getElementById("box2").checked = false;
  }
}

// Cloudinary Upload Widget
function openCloudinaryWidget() {
  cloudinary.openUploadWidget({
    cloudName: cloudinaryConfig.cloudName,
    uploadPreset: cloudinaryConfig.uploadPreset,
    folder: cloudinaryConfig.folder,
    sources: ['local', 'camera', 'url'],
    resourceType: 'image',
    clientAllowedFormats: ['jpg', 'jpeg', 'png', 'pdf'],
    maxFileSize: 5000000, // 5MB
    multiple: false,
    showUploadMoreButton: false,
    showAdvancedOptions: false,
    cropping: false,
    singleUploadAutoClose: true
  }, (error, result) => {
    if (!error && result && result.event === 'success') {
      handleUploadSuccess(result.info);
    } else if (error) {
      handleUploadError(error);
    }
  });
}

function handleUploadSuccess(result) {
  uploadedImageData = result;
  
  // Store image data
  document.getElementById('id_image_url').value = result.secure_url;
  document.getElementById('id_image_public_id').value = result.public_id;
  
  // Update UI
  document.getElementById('upload-text').innerHTML = 'âœ… Image uploaded successfully!';
  document.getElementById('upload-preview').innerHTML = 
    `<img src="${result.secure_url}" alt="Uploaded ID" /><br>
     <small>Filename: ${result.original_filename}</small>`;
  document.getElementById('upload-status').innerHTML = 
    `<span style="color: green;">âœ“ Ready to submit</span>`;
  
  console.log('Upload successful:', result);
}

function handleUploadError(error) {
  document.getElementById('upload-status').innerHTML = 
    `<span style="color: red;">âœ— Upload failed: ${error.message}</span>`;
  console.error('Upload error:', error);
}

function validateForm() {
  let isValid = true;
  
  // Clear previous errors
  document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
  
  // Main payment type validation
  const cash = document.querySelector('input[name="payment_type"][value="Cash"]').checked;
  const card = document.querySelector('input[name="payment_type"][value="Card"]').checked;
  const typeError = document.getElementById("payment-type-error");

  if (!cash && !card) {
    typeError.style.display = "block";
    isValid = false;
  }

  // If CARD is chosen, enforce sub-options
  if (card) {
    const callIn = document.getElementById("box1").checked;
    const autoPay = document.getElementById("box2").checked;
    const cardError = document.getElementById("checkbox-error");

    if (!callIn && !autoPay) {
      cardError.style.display = "block";
      isValid = false;
    }
  }

  // Text opt-in validation
  const textYes = document.getElementById("text_yes").checked;
  const textNo = document.getElementById("text_no").checked;
  const textError = document.getElementById("text-checkbox-error");

  if (!textYes && !textNo) {
    textError.style.display = "block";
    isValid = false;
  }

  // Image upload validation
  if (!uploadedImageData) {
    document.getElementById('upload-status').innerHTML = 
      '<span style="color: red;">âœ— Please upload your government ID</span>';
    isValid = false;
  }

  return isValid;
}

async function submitForm(formData) {
  try {
    // Show loading
    document.getElementById('loading').style.display = 'block';
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('error-alert').style.display = 'none';

    // Collect form data
    const data = {};
    
    // Process each form field
    for (let [key, value] of formData.entries()) {
      // Skip sensitive card data for security
      if (key === "card_number" || key === "card_cvv" || key === "card_expiration") {
        continue;
      }
      data[key] = value;
    }
    
    // Add image data if uploaded
    if (uploadedImageData) {
      data.id_image_url = uploadedImageData.secure_url;
      data.id_image_public_id = uploadedImageData.public_id;
      data.id_image_original_filename = uploadedImageData.original_filename;
      data.id_image_size = uploadedImageData.bytes;
      data.id_image_format = uploadedImageData.format;
    }
    
    // Add metadata
    data.timestamp = new Date().toISOString();
    data.storage_provider = "Cloudinary";
    data.data_location = "Firebase Firestore";

    // Save to Firestore (single source of truth)
    const docRef = await db.collection("submissions").add(data);
    console.log("Document written with ID: ", docRef.id);
    
    // Show success message
    document.getElementById('loading').style.display = 'none';
    document.getElementById('success-message').style.display = 'block';
    
    // Redirect after 2 seconds
    setTimeout(() => {
      window.location.href = "https://2avi2.github.io/Storage-Plus/thank-you.html";
    }, 2000);
    
  } catch (error) {
    console.error("Error submitting form:", error);
    
    // Hide loading and re-enable button
    document.getElementById('loading').style.display = 'none';
    document.getElementById('submitBtn').disabled = false;
    
    // Show error message
    document.getElementById('error-alert').style.display = 'block';
    document.getElementById('error-alert').textContent = 'Error: ' + error.message;
  }
}

// Combined form submission handler
document.getElementById('intakeForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  // Validate form
  if (!validateForm()) {
    return;
  }
  
  // Get form data
  const formData = new FormData(e.target);
  
  // Submit form
  await submitForm(formData);
});

// Initialize form
document.addEventListener('DOMContentLoaded', function() {
  console.log('Cloudinary + Firebase form initialized successfully');
});
</script>

</body>
</html>