<!DOCTYPE html>
<head>
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {font-family:Arial,sans-serif;background-color:#f5f5f5;color:#333;}
    h1 {color:#001f3f;text-align:center;margin:30px 0 20px;font-size:32px;}
    h2 {color:#001f3f;border-bottom:3px solid #001f3f;padding-bottom:10px;margin:30px 0 20px;font-size:22px;}
    .required-note {color:#001f3f;font-size:14px;margin-bottom:20px;font-weight:bold;}
    form {max-width:900px;margin:0 auto;background-color:white;padding:40px;border-radius:8px;box-shadow:0 2px 10px rgba(0,31,63,0.1);}
    .form-section {margin-bottom:40px;padding-bottom:30px;border-bottom:2px solid #e0e0e0;}
    .form-section:last-of-type {border-bottom:none;}
    .section-title {color:white;background-color:#001f3f;padding:12px 16px;border-radius:4px;margin-bottom:20px;font-size:18px;font-weight:bold;}
    .form-row {display:flex;gap:20px;margin-bottom:20px;}
    .form-row div {flex:1;}
    .form-row p {margin:0 0 8px;}
    .form-row input {width:100%;padding:12px;border:2px solid #ddd;border-radius:4px;font-size:14px;transition:border-color 0.3s;}
    .form-row input:focus {outline:none;border-color:#001f3f;box-shadow:0 0 5px rgba(0,31,63,0.2);}
    p {margin:0 0 8px;line-height:1.6;color:#333;font-size:15px;}
    label {font-size:15px;margin-right:15px;cursor:pointer;display:inline-flex;align-items:center;}
    input[type="text"],input[type="email"],input[type="tel"] {width:100%;padding:12px;border:2px solid #ddd;border-radius:4px;font-size:14px;margin-bottom:12px;transition:border-color 0.3s;}
    input[type="text"]:focus,input[type="email"]:focus,input[type="tel"]:focus {outline:none;border-color:#001f3f;box-shadow:0 0 5px rgba(0,31,63,0.2);}
    input[type="checkbox"], input[type="radio"] {width:18px;height:18px;margin-right:8px;cursor:pointer;accent-color:#001f3f;}
    .checkbox-group {margin:15px 0;}
    .checkbox-group label {display:flex;align-items:center;margin-bottom:10px;}
    .error-message {color:#d32f2f;font-size:13px;margin-top:5px;display:none;}
    button[type="submit"] {background-color:#001f3f;color:white;padding:14px 40px;border:none;border-radius:4px;font-size:16px;font-weight:bold;cursor:pointer;margin-top:20px;transition:background-color 0.3s;width:100%;}
    button[type="submit"]:hover {background-color:#000d1f;}
    button[type="submit"]:active {background-color:#000;}
    .hidden {display:none;}
    .logo {max-width:100%;height:auto;display:block;margin:0 auto;}
  </style>
</head>
<body>
  <img src="./1.png" alt="Storage Plus Logo" class="logo">
  <h1>Storage Plus Intake Form</h1>
  <p class="required-note">* Indicates required fields</p>

  <form id="intakeForm">
    <!-- Contact Information -->
    <div class="form-section">
      <div class="section-title">Contact Information</div>
      <div class="form-row">
        <div>
          <p>Mobile #: <span style="color:red;">*</span></p>
          <input type="tel" name="mobile_number" required placeholder="Enter mobile number">
        </div>
        <div>
          <p>Work#:</p>
          <input type="tel" name="work_number" placeholder="Enter work number">
        </div>
      </div>
      <p>Primary Email Address: <span style="color:red;">*</span></p>
      <input type="email" name="email" required placeholder="Enter email address">
      <p>Opt in for Text Messages (Msg & Data rates may apply) <span style="color:red;">*</span></p>
      <div class="checkbox-group">
        <label><input type="radio" name="text_opt_in" value="Yes" id="text_yes"> Yes</label>
<label><input type="radio" name="text_opt_in" value="No" id="text_no"> No</label>
<div id="text-checkbox-error" class="error-message">Please select Yes or No for text message opt-in</div>

      </div>
    </div>

    <!-- Personal Information -->
    <div class="form-section">
      <div class="section-title">Personal Information</div>
      <p>Business Name (if applicable):</p>
      <input type="text" name="business_name" placeholder="Enter business name">
      <div class="form-row">
        <div>
          <p>First & Middle Name <span style="color:red;">*</span></p>
          <input type="text" name="first_middle_name" required placeholder="Enter first & middle name">
        </div>
        <div>
          <p>Last Name <span style="color:red;">*</span></p>
          <input type="text" name="last_name" required placeholder="Enter last name">
        </div>
      </div>
      <p>Address: <span style="color:red;">*</span></p>
      <input type="text" name="address" required placeholder="Enter street address">
      <div class="form-row">
        <div>
          <p>Apt/Ste/FL: <span style="color:red;">*</span></p>
          <input type="text" name="apt_ste_fl" required placeholder="Apartment/Suite/Floor">
        </div>
        <div>
          <p>City: <span style="color:red;">*</span></p>
          <input type="text" name="city" required placeholder="Enter city">
        </div>
      </div>
      <div class="form-row">
        <div>
          <p>State: <span style="color:red;">*</span></p>
          <input type="text" name="state" required placeholder="Enter state">
        </div>
        <div>
          <p>Zip code: <span style="color:red;">*</span></p>
          <input type="text" name="zip_code" required placeholder="Enter zip code">
        </div>
      </div>
    </div>

    <!-- Emergency Contact -->
    <div class="form-section">
      <div class="section-title">Emergency Contact</div>
      <p>We will only contact this person in the event of an emergency or as a last resort if the unit is assigned to auction.</p>
      <p>First and Last Name: <span style="color:red;">*</span></p>
      <input type="text" name="emergency_person_1" required placeholder="Enter first and last name">
      <div class="form-row">
        <div>
          <p>Phone: <span style="color:red;">*</span></p>
          <input type="tel" name="emergency_phone" required placeholder="Enter phone number">
        </div>
      </div>
    </div>

    <!-- Additional Access Authorization -->
    <div class="form-section">
      <div class="section-title">Additional Access Authorization</div>
      <p>Additional Person(s) authorized for Access (vacate/close account, transfer, cutluck):</p>
      <p>First and Last Name #1:</p>
      <input type="text" name="authorized_person_1" placeholder="Enter first and last name">
      <p>First and Last Name #2:</p>
      <input type="text" name="authorized_person_2" placeholder="Enter first and last name">
      <div class="form-row">
        <div>
          <p>Phone #1:</p>
          <input type="tel" name="phone_1" placeholder="Enter first phone number">
        </div>
        <div>
          <p>Phone #2:</p>
          <input type="tel" name="phone_2" placeholder="Enter second phone number">
        </div>
      </div>
      <p>Owner hereby grants month to month permission to the occupant listed above to store personal property according to the terms and conditions of this agreement in the stored unit at the facility first name above commencing on ____: <span style="color:red;">*</span></p>
      <input type="date" name="commencement_date" required>
    </div>

    <!-- Payment Information -->
    <div class="form-section">
      <div class="section-title">Payment Information</div>
      <p><strong>Choose Payment Type: <span style="color:red;">*</span></strong></p>
      <label><input type="radio" name="payment_type" value="Cash" onclick="togglePaymentOptions()" required> Cash</label>
      <label><input type="radio" name="payment_type" value="Card" onclick="togglePaymentOptions()" required> Card</label>
      <div id="payment-type-error" class="error-message">Please select Cash or Card</div>
      <br><br>

      <div id="cardSubOptions" class="hidden">
        <p><strong>Card Payment Options:</strong></p>
        <label><input type="radio" id="box1" name="payment_method" value="Call In Payment"> Call-In Payment</label>
        <label><input type="radio" id="box2" name="payment_method" value="Auto-payment"> Auto-payment</label>
        <div id="checkbox-error" class="error-message">Please select a card payment option</div>
        <br><br>

        <p>Card Number: <span style="color:red;">*</span></p>
        <input type="text" id="card_number" name="card_number" placeholder="Enter card number">

        <p>Security Code (CVV): <span style="color:red;">*</span></p>
        <input type="text" id="card_cvv" name="card_cvv" placeholder="Enter CVV" maxlength="4">

        <p>Expiration Date (MM/YY): <span style="color:red;">*</span></p>
        <input type="text" id="card_expiration" name="card_expiration" placeholder="MM/YY">

        <p>Billing Address: <span style="color:red;">*</span></p>
        <input type="text" id="billing_address" name="billing_address" placeholder="Enter billing address">
        <label><input type="checkbox" id="same_address_checkbox"> Same address as above</label>
      </div>
    </div>

    <!-- Government ID -->
    <div class="form-section">
      <div class="section-title">Government Issued ID Upload</div>
      <p>Please upload a clear photo of your government-issued ID (Driverâ€™s License, Passport, etc.) <span style="color:red;">*</span></p>
      <input type="file" name="id_upload" accept="image/*" required>
    </div>

    <!-- Agreement -->
    <div class="form-section">
      <div class="section-title">Agreement & Signature</div>
      <p>Name: <span style="color:red;">*</span></p>
      <input type="text" name="full_name" required placeholder="Enter your Full Name" maxlength="100">
    </div>

    <input type="hidden" name="_next" value="https://2avi2.github.io/Storage-Plus/thank-you.html">
    <button type="submit">Submit Form</button>
  </form>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

  <script>
    // Initialize Firebase (Storage needs the appspot.com bucket)
    const firebaseConfig = {
      apiKey: "AIzaSyDxqszQiV8YOQ15QXrFuyeUOYPOdfG-BHQ",
      authDomain: "intake-form-e180e.firebaseapp.com",
      projectId: "intake-form-e180e",
      storageBucket: "intake-form-e180e.appspot.com",
      messagingSenderId: "97526846862",
      appId: "1:97526846862:web:a49c6f44241b3eb2a9c0df"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Submit handler (single listener)
    document.getElementById("intakeForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      // Validate payment type
      const cash = document.querySelector('input[name="payment_type"][value="Cash"]').checked;
      const card = document.querySelector('input[name="payment_type"][value="Card"]').checked;
      const typeError = document.getElementById("payment-type-error");
      let isValid = true;

      if (!cash && !card) {
        typeError.style.display = "block";
        isValid = false;
      } else {
        typeError.style.display = "none";
      }

      // Validate text opt-in selection
      const textYes = document.getElementById("text_yes")?.checked;
      const textNo  = document.getElementById("text_no")?.checked;
      const textError = document.getElementById("text-checkbox-error");
      if (!textYes && !textNo) {
        textError.style.display = "block";
        isValid = false;
      } else {
        textError.style.display = "none";
      }

      // If card selected, ensure sub options chosen
      if (card) {
        const callIn = document.getElementById("box1").checked;
        const autoPay = document.getElementById("box2").checked;
        const cardError = document.getElementById("checkbox-error");
        if (!callIn && !autoPay) {
          cardError.style.display = "block";
          isValid = false;
        } else {
          cardError.style.display = "none";
        }
      }

      if (!isValid) return;

      // Collect form data
      const form = e.target;
      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => {
        if (key !== "id_upload") data[key] = value; // exclude raw file
      });
      data.timestamp = Date.now();

      // Upload ID image to Storage and attach URL
      const file = formData.get("id_upload");
      if (file && file.size > 0) {
        const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, "_");
        const storageRef = storage.ref(`ids/${Date.now()}_${safeName}`);
        await storageRef.put(file);
        data.id_image_url = await storageRef.getDownloadURL();
      }

      // IMPORTANT: Do NOT store raw card data in Firestore (PCI)
      // If collecting card, remove raw fields before save:
      delete data.card_number;
      delete data.card_cvv;
      delete data.card_expiration;

      try {
        await db.collection("submissions").add(data);
        window.location.href = "https://2avi2.github.io/Storage-Plus/thank-you.html";
      } catch (error) {
        console.error("Error adding document:", error);
        alert("There was an error submitting the form.");
      }
    });

    // Toggle payment options + requireds
    function togglePaymentOptions() {
      const cardSelected = document.querySelector('input[name="payment_type"][value="Card"]').checked;
      const cardDiv = document.getElementById("cardSubOptions");
      const cardFields = [
        document.getElementById("card_number"),
        document.getElementById("card_cvv"),
        document.getElementById("card_expiration"),
        document.getElementById("billing_address")
      ];

      if (cardSelected) {
        cardDiv.classList.remove("hidden");
        cardFields.forEach(field => field && field.setAttribute("required", "true"));
      } else {
        cardDiv.classList.add("hidden");
        cardFields.forEach(field => field && field.removeAttribute("required"));
        document.getElementById("box1").checked = false;
        document.getElementById("box2").checked = false;

        const sameAddress = document.getElementById("same_address_checkbox");
        if (sameAddress) sameAddress.checked = false;

        const billingInput = document.getElementById("billing_address");
        if (billingInput) {
          billingInput.style.display = "block";
          billingInput.value = "";
        }
      }
    }

    // Same address checkbox -> hide billing
    document.addEventListener("DOMContentLoaded", function() {
      const sameAddressCheckbox = document.getElementById("same_address_checkbox");
      const billingInput = document.getElementById("billing_address");
      if (sameAddressCheckbox) {
        sameAddressCheckbox.addEventListener("change", function() {
          const cardSelected = document.querySelector('input[name="payment_type"][value="Card"]').checked;
          if (this.checked) {
            billingInput.style.display = "none";
            billingInput.removeAttribute("required");
            billingInput.value = "";
          } else {
            billingInput.style.display = "block";
            if (cardSelected) billingInput.setAttribute("required", "true");
          }
        });
      }
    });

    // Enter-to-next navigation across required inputs
    document.querySelectorAll('input[required]').forEach((input, index, allInputs) => {
      input.addEventListener('keydown', function(e) {
        if (e.key === "Enter") {
          e.preventDefault();
          if (!input.value.trim()) {
            alert(input.name + " is required!");
            input.focus();
          } else {
            const next = allInputs[index + 1];
            if (next) next.focus();
          }
        }
      });
    });
  </script>
</body>
</html>

